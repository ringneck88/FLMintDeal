{"version":3,"file":"Widgets.mjs","sources":["../../../../../admin/src/components/Widgets.tsx"],"sourcesContent":["import { useAuth } from '@strapi/admin/strapi-admin';\nimport { Avatar, Badge, Box, Flex, Typography } from '@strapi/design-system';\nimport { Earth, Images, User, Key, Files, Layout, Graph, Webhooks } from '@strapi/icons';\nimport { useIntl } from 'react-intl';\nimport { styled } from 'styled-components';\n\nimport { useGetCountDocumentsQuery, useGetKeyStatisticsQuery } from '../services/homepage';\nimport { getDisplayName, getInitials } from '../utils/users';\n\nimport { Widget } from './WidgetHelpers';\n\n/* -------------------------------------------------------------------------------------------------\n * ProfileWidget\n * -----------------------------------------------------------------------------------------------*/\n\nconst DisplayNameTypography = styled(Typography)`\n  font-size: 2.4rem;\n`;\n\nconst ProfileWidget = () => {\n  const user = useAuth('User', (state) => state.user);\n  const userDisplayName = getDisplayName(user);\n  const initials = getInitials(user);\n\n  return (\n    <Flex direction=\"column\" gap={3} height=\"100%\" justifyContent=\"center\">\n      <Avatar.Item delayMs={0} fallback={initials} />\n      {userDisplayName && (\n        <DisplayNameTypography fontWeight=\"bold\" textTransform=\"none\" textAlign=\"center\">\n          {userDisplayName}\n        </DisplayNameTypography>\n      )}\n      {user?.email && (\n        <Typography variant=\"omega\" textColor=\"neutral600\">\n          {user?.email}\n        </Typography>\n      )}\n      {user?.roles?.length && (\n        <Flex marginTop={2} gap={1} wrap=\"wrap\">\n          {user?.roles?.map((role) => <Badge key={role.id}>{role.name}</Badge>)}\n        </Flex>\n      )}\n    </Flex>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * Key Statistics\n * -----------------------------------------------------------------------------------------------*/\nconst Grid = styled(Box)`\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 0;\n  border: 1px solid ${({ theme }) => theme.colors.neutral200};\n  border-radius: ${({ theme }) => theme.borderRadius};\n  overflow: hidden;\n`;\n\nconst GridCell = styled(Box)`\n  border-bottom: 1px solid ${({ theme }) => theme.colors.neutral200};\n  border-right: 1px solid ${({ theme }) => theme.colors.neutral200};\n  display: flex;\n  flex-direction: row;\n  align-items: flex-start;\n\n  &:nth-child(2n) {\n    border-right: none;\n  }\n  &:nth-last-child(-n + 2) {\n    border-bottom: none;\n  }\n`;\n\nconst formatNumber = ({ locale, number }: { locale: string; number: number }) => {\n  return new Intl.NumberFormat(locale, {\n    notation: 'compact',\n    maximumFractionDigits: 1,\n  }).format(number);\n};\n\nconst KeyStatisticsWidget = () => {\n  const { formatMessage, locale } = useIntl();\n  const { data: countDocuments, isLoading: isLoadingCountDocuments } = useGetCountDocumentsQuery();\n  const { data: countKeyStatistics, isLoading: isLoadingKeyStatistics } =\n    useGetKeyStatisticsQuery();\n\n  if (isLoadingKeyStatistics || isLoadingCountDocuments) {\n    return <Widget.Loading />;\n  }\n\n  if (!countKeyStatistics || !countDocuments) {\n    return <Widget.Error />;\n  }\n\n  const keyStatisticsList = {\n    entries: {\n      label: {\n        id: 'widget.key-statistics.list.entries',\n        defaultMessage: 'Entries',\n      },\n      icon: {\n        component: <Files />,\n        background: 'primary100',\n        color: 'primary600',\n      },\n    },\n    assets: {\n      label: {\n        id: 'widget.key-statistics.list.assets',\n        defaultMessage: 'Assets',\n      },\n      icon: {\n        component: <Images />,\n        background: 'warning100',\n        color: 'warning600',\n      },\n    },\n    contentTypes: {\n      label: {\n        id: 'widget.key-statistics.list.contentTypes',\n        defaultMessage: 'Content-Types',\n      },\n      icon: {\n        component: <Layout />,\n        background: 'secondary100',\n        color: 'secondary600',\n      },\n    },\n    components: {\n      label: {\n        id: 'widget.key-statistics.list.components',\n        defaultMessage: 'Components',\n      },\n      icon: {\n        component: <Graph />,\n        background: 'alternative100',\n        color: 'alternative600',\n      },\n    },\n    locales: {\n      label: {\n        id: 'widget.key-statistics.list.locales',\n        defaultMessage: 'Locales',\n      },\n      icon: {\n        component: <Earth />,\n        background: 'success100',\n        color: 'success600',\n      },\n    },\n    admins: {\n      label: {\n        id: 'widget.key-statistics.list.admins',\n        defaultMessage: 'Admins',\n      },\n      icon: {\n        component: <User />,\n        background: 'danger100',\n        color: 'danger600',\n      },\n    },\n    webhooks: {\n      label: {\n        id: 'widget.key-statistics.list.webhooks',\n        defaultMessage: 'Webhooks',\n      },\n      icon: {\n        component: <Webhooks />,\n        background: 'alternative100',\n        color: 'alternative600',\n      },\n    },\n    apiTokens: {\n      label: {\n        id: 'widget.key-statistics.list.apiTokens',\n        defaultMessage: 'API Tokens',\n      },\n      icon: {\n        component: <Key />,\n        background: 'neutral100',\n        color: 'neutral600',\n      },\n    },\n  };\n\n  const { draft, published, modified } = countDocuments ?? {\n    draft: 0,\n    published: 0,\n    modified: 0,\n  };\n\n  const totalCountEntries = draft + published + modified;\n\n  return (\n    <Grid>\n      {Object.entries(keyStatisticsList).map(([key, item]) => {\n        const value = countKeyStatistics?.[key as keyof typeof countKeyStatistics];\n        return (\n          value !== null && (\n            <GridCell key={`key-statistics-${key}`} padding={3} data-testid={`stat-${key}`}>\n              <Flex alignItems=\"center\" gap={2}>\n                <Flex\n                  padding={2}\n                  borderRadius={1}\n                  background={item.icon.background}\n                  color={item.icon.color}\n                >\n                  {item.icon.component}\n                </Flex>\n                <Flex direction=\"column\" alignItems=\"flex-start\">\n                  <Typography variant=\"pi\" fontWeight=\"bold\" textColor=\"neutral500\">\n                    {formatMessage(item.label)}\n                  </Typography>\n                  <Typography variant=\"omega\" fontWeight=\"bold\" textColor=\"neutral800\">\n                    {formatNumber({\n                      locale,\n                      number: key === 'entries' ? totalCountEntries : value,\n                    })}\n                  </Typography>\n                </Flex>\n              </Flex>\n            </GridCell>\n          )\n        );\n      })}\n    </Grid>\n  );\n};\n\nexport { ProfileWidget, KeyStatisticsWidget };\n"],"names":["DisplayNameTypography","styled","Typography","ProfileWidget","user","useAuth","state","userDisplayName","getDisplayName","initials","getInitials","_jsxs","Flex","direction","gap","height","justifyContent","_jsx","Avatar","Item","delayMs","fallback","fontWeight","textTransform","textAlign","email","variant","textColor","roles","length","marginTop","wrap","map","role","Badge","name","id","Grid","Box","theme","colors","neutral200","borderRadius","GridCell","formatNumber","locale","number","Intl","NumberFormat","notation","maximumFractionDigits","format","KeyStatisticsWidget","formatMessage","useIntl","data","countDocuments","isLoading","isLoadingCountDocuments","useGetCountDocumentsQuery","countKeyStatistics","isLoadingKeyStatistics","useGetKeyStatisticsQuery","Widget","Loading","Error","keyStatisticsList","entries","label","defaultMessage","icon","component","Files","background","color","assets","Images","contentTypes","Layout","components","Graph","locales","Earth","admins","User","webhooks","Webhooks","apiTokens","Key","draft","published","modified","totalCountEntries","Object","key","item","value","padding","data-testid","alignItems"],"mappings":"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"}