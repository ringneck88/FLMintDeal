---
export const prerender = true;
import Layout from '../../layouts/Layout.astro';
import { strapi } from '../../lib/strapi';

// Generate static paths for all dosage forms
export async function getStaticPaths() {
  try {
    // Fetch all dosage forms from Strapi with timeout
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 5000);
    
    const dosageResponse = await strapi.getMany('/dosage-forms');
    clearTimeout(timeoutId);
    
    if (dosageResponse && dosageResponse.data) {
      const paths = dosageResponse.data
        .filter(form => form.publishedAt || !form.publishedAt) // Include all for now
        .map(form => ({
          params: { 
            slug: form.slug || form.Name?.toLowerCase().replace(/[^a-z0-9]+/g, '-') || `form-${form.id}`
          },
          props: { 
            dosageForm: {
              id: form.id,
              name: form.Name || form.name,
              description: form.Description || form.Discription || form.description,
              slug: form.slug || form.Name?.toLowerCase().replace(/[^a-z0-9]+/g, '-') || `form-${form.id}`,
              image: `https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=800&h=600&fit=crop&q=80`,
              createdAt: form.createdAt,
              updatedAt: form.updatedAt,
              publishedAt: form.publishedAt
            }
          }
        }));
      return paths;
    }
  } catch (error) {
    console.warn('Failed to fetch dosage forms for static generation:', error.message);
  }
  
  // Return empty array if no forms found or error occurred
  return [];
}

// Get the dosage form from props (passed from getStaticPaths)
const { dosageForm } = Astro.props;
---

<Layout title={`${dosageForm.name} - Dosage Form - FLMintDeals`}>
  <!-- Breadcrumb -->
  <div class="bg-gray-50 py-4">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <nav class="flex" aria-label="Breadcrumb">
        <ol class="flex items-center space-x-2">
          <li>
            <a href="/" class="text-blue-600 hover:text-blue-800">Home</a>
          </li>
          <li>
            <span class="text-gray-500">/</span>
          </li>
          <li>
            <a href="/dosage-products" class="text-blue-600 hover:text-blue-800">Dosage Forms</a>
          </li>
          <li>
            <span class="text-gray-500">/</span>
          </li>
          <li>
            <span class="text-gray-900 font-medium">{dosageForm.name}</span>
          </li>
        </ol>
      </nav>
    </div>
  </div>

  <!-- Form Detail -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      
      <!-- Form Image -->
      <div class="aspect-square">
        <img 
          src={dosageForm.image} 
          alt={dosageForm.name}
          class="w-full h-full object-cover rounded-lg shadow-lg"
        />
      </div>

      <!-- Form Details -->
      <div class="space-y-6">
        <!-- Header -->
        <div>
          <div class="flex items-center space-x-2 mb-2">
            <span class="inline-block bg-green-100 text-green-800 text-sm px-3 py-1 rounded-full font-semibold">
              Dosage Form
            </span>
            {dosageForm.publishedAt && (
              <span class="bg-blue-100 text-blue-800 text-sm px-3 py-1 rounded font-medium">
                Published
              </span>
            )}
          </div>
          <h1 class="text-3xl font-bold text-gray-900 mb-4">{dosageForm.name}</h1>
        </div>

        <!-- Description -->
        <div>
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Description</h3>
          <p class="text-gray-600 leading-relaxed">{dosageForm.description}</p>
        </div>

        <!-- Metadata -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="bg-gray-50 p-4 rounded-lg">
            <h4 class="font-semibold text-gray-900 mb-1">Form ID</h4>
            <p class="text-gray-700">{dosageForm.id}</p>
          </div>
          <div class="bg-gray-50 p-4 rounded-lg">
            <h4 class="font-semibold text-gray-900 mb-1">Last Updated</h4>
            <p class="text-gray-700">{new Date(dosageForm.updatedAt).toLocaleDateString()}</p>
          </div>
          {dosageForm.createdAt && (
            <div class="bg-gray-50 p-4 rounded-lg">
              <h4 class="font-semibold text-gray-900 mb-1">Created</h4>
              <p class="text-gray-700">{new Date(dosageForm.createdAt).toLocaleDateString()}</p>
            </div>
          )}
          {dosageForm.publishedAt && (
            <div class="bg-gray-50 p-4 rounded-lg">
              <h4 class="font-semibold text-gray-900 mb-1">Published</h4>
              <p class="text-gray-700">{new Date(dosageForm.publishedAt).toLocaleDateString()}</p>
            </div>
          )}
        </div>

        <!-- Action Buttons -->
        <div class="space-y-4 pt-6">
          <a href="/dosage-products" class="w-full bg-green-600 text-white py-4 px-6 rounded-lg text-lg font-semibold hover:bg-green-700 transition-colors duration-200 shadow-lg block text-center">
            Back to All Forms
          </a>
          <button class="w-full border-2 border-gray-300 text-gray-700 py-3 px-6 rounded-lg font-medium hover:border-gray-400 transition-colors duration-200">
            Save to References
          </button>
        </div>
      </div>
    </div>

    <!-- Additional Information -->
    <div class="mt-16">
      <div class="bg-blue-50 border-l-4 border-blue-400 p-6">
        <div class="flex">
          <div class="flex-shrink-0">
            <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div class="ml-3">
            <h3 class="text-sm font-medium text-blue-800">About Dosage Forms</h3>
            <div class="mt-2 text-sm text-blue-700">
              <p>
                Dosage forms refer to the physical form in which a medication is manufactured and dispensed. 
                Different forms can affect how quickly the medication is absorbed, where it acts in the body, 
                and how convenient it is for patients to use. Common forms include tablets, capsules, liquids, 
                injections, topical preparations, and more.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Medical Disclaimer -->
    <div class="mt-8 bg-gray-50 border border-gray-200 rounded-lg p-8">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Medical Disclaimer</h3>
      <p class="text-gray-700 leading-relaxed">
        This information is provided for educational purposes only and is not intended to replace professional medical advice, diagnosis, or treatment. 
        Always seek the advice of your physician or other qualified health provider with any questions you may have regarding a medical condition.
      </p>
    </div>
  </div>
</Layout>