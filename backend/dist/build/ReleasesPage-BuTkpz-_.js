import{r as z,u as M,ar as J,as as X,j as e,aU as B,U as F,cw as x,bz as K,bA as V,l as S,a0 as g,b1 as ee,a8 as y,bH as te,h as w,cY as ae,cZ as se,X as D,c_ as ne,c$ as ie,a1 as re,a2 as oe,a as le,a7 as de,b as ce,q as ue,d0 as me,Q as ge,d1 as he,bR as fe,s as pe,c as xe,d2 as je,d as q,aY as be,L as $,aP as Re,W as Ce,bW as H,d3 as R,bs as ze,cO as L,o as E,d4 as Me,E as Te,O as ye,Z as U,aO as Se,af as ve,_ as Le}from"./strapi-Cxs8f-5s.js";import{t as we,a as De,R as Ee,z as ke}from"./schemas-CvcvY6cu.js";import{f as Ae}from"./index-_cwZFM_k.js";import{f as Ie}from"./index-CBWxmToP.js";function Pe(o,a,m){var s=we(o,m),n=De(a,s,!0),t=new Date(s.getTime()-n),u=new Date(0);return u.setFullYear(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),u.setHours(t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()),u}const Oe=["years","months","days","hours","minutes","seconds"],$e=z.forwardRef(({timestamp:o,customIntervals:a=[],...m},s)=>{const{formatRelativeTime:n,formatDate:t,formatTime:u}=M(),r=J({start:o,end:Date.now()}),h=Oe.find(i=>r[i]>0&&Object.keys(r).includes(i)),d=X(o)?-r[h]:r[h],p=a.find(i=>r[i.unit]<i.threshold),j=p?p.text:n(d,h,{numeric:"auto"});return e.jsx("time",{ref:s,dateTime:o.toISOString(),role:"time",title:`${t(o)} ${u(o)}`,...m,children:j})}),Ue=({handleClose:o,open:a,handleSubmit:m,initialValues:s,isLoading:n=!1})=>{const{formatMessage:t}=M(),{pathname:u}=B(),r=u===`/plugins/${ne}`,{timezoneList:h,systemTimezone:d={value:"UTC+00:00-Africa/Abidjan "}}=F(s.scheduledAt?new Date(s.scheduledAt):new Date),p=i=>{const{date:c,time:b,timezone:l}=i;if(!c||!b||!l)return null;const f=l.split("&")[1];return ke(`${c} ${b}`,f)},j=()=>h.find(c=>c.value.split("&")[1]===s.timezone)?.value||d.value;return e.jsx(x.Root,{open:a,onOpenChange:o,children:e.jsxs(x.Content,{children:[e.jsx(x.Header,{children:e.jsx(x.Title,{children:t({id:"content-releases.modal.title",defaultMessage:"{isCreatingRelease, select, true {New release} other {Edit release}}"},{isCreatingRelease:r})})}),e.jsx(K,{onSubmit:i=>{m({...i,timezone:i.timezone?i.timezone.split("&")[1]:null,scheduledAt:i.isScheduled?p(i):null})},initialValues:{...s,timezone:s.timezone?j():d.value},validationSchema:Ee,validateOnChange:!1,children:({values:i,errors:c,handleChange:b,setFieldValue:l})=>e.jsxs(V,{children:[e.jsx(x.Body,{children:e.jsxs(S,{direction:"column",alignItems:"stretch",gap:6,children:[e.jsxs(g.Root,{name:"name",error:c.name&&t({id:c.name,defaultMessage:c.name}),required:!0,children:[e.jsx(g.Label,{children:t({id:"content-releases.modal.form.input.label.release-name",defaultMessage:"Name"})}),e.jsx(ee,{value:i.name,onChange:b}),e.jsx(g.Error,{})]}),e.jsx(y,{width:"max-content",children:e.jsx(te,{name:"isScheduled",checked:i.isScheduled,onCheckedChange:f=>{l("isScheduled",f),f?(l("date",s.date),l("time",s.time),l("timezone",s.timezone??d?.value)):(l("date",null),l("time",""),l("timezone",null))},children:e.jsx(w,{textColor:i.isScheduled?"primary600":"neutral800",fontWeight:i.isScheduled?"semiBold":"regular",children:t({id:"modal.form.input.label.schedule-release",defaultMessage:"Schedule release"})})})}),i.isScheduled&&e.jsxs(e.Fragment,{children:[e.jsxs(S,{gap:4,alignItems:"start",children:[e.jsx(y,{width:"100%",children:e.jsxs(g.Root,{name:"date",error:c.date&&t({id:c.date,defaultMessage:c.date}),required:!0,children:[e.jsx(g.Label,{children:t({id:"content-releases.modal.form.input.label.date",defaultMessage:"Date"})}),e.jsx(ae,{onChange:f=>{const v=f?Ae(f,{representation:"date"}):null;l("date",v)},clearLabel:t({id:"content-releases.modal.form.input.clearLabel",defaultMessage:"Clear"}),onClear:()=>{l("date",null)},value:i.date?new Date(i.date):new Date,minDate:Pe(new Date,i.timezone.split("&")[1])}),e.jsx(g.Error,{})]})}),e.jsx(y,{width:"100%",children:e.jsxs(g.Root,{name:"time",error:c.time&&t({id:c.time,defaultMessage:c.time}),required:!0,children:[e.jsx(g.Label,{children:t({id:"content-releases.modal.form.input.label.time",defaultMessage:"Time"})}),e.jsx(se,{onChange:f=>{l("time",f)},clearLabel:t({id:"content-releases.modal.form.input.clearLabel",defaultMessage:"Clear"}),onClear:()=>{l("time","")},value:i.time||void 0}),e.jsx(g.Error,{})]})})]}),e.jsx(Ne,{timezoneOptions:h})]})]})}),e.jsxs(x.Footer,{children:[e.jsx(x.Close,{children:e.jsx(D,{variant:"tertiary",name:"cancel",children:t({id:"cancel",defaultMessage:"Cancel"})})}),e.jsx(D,{name:"submit",loading:n,type:"submit",children:t({id:"content-releases.modal.form.button.submit",defaultMessage:"{isCreatingRelease, select, true {Continue} other {Save}}"},{isCreatingRelease:r})})]})]})})]})})},Ne=({timezoneOptions:o})=>{const{values:a,errors:m,setFieldValue:s}=ie(),{formatMessage:n}=M(),[t,u]=z.useState(o);return z.useEffect(()=>{if(a.date){const{timezoneList:r}=F(new Date(a.date));u(r);const h=a.timezone&&r.find(d=>d.value.split("&")[1]===a.timezone.split("&")[1]);h&&s("timezone",h.value)}},[s,a.date,a.timezone]),e.jsxs(g.Root,{name:"timezone",error:m.timezone&&n({id:m.timezone,defaultMessage:m.timezone}),required:!0,children:[e.jsx(g.Label,{children:n({id:"content-releases.modal.form.input.label.timezone",defaultMessage:"Timezone"})}),e.jsx(re,{autocomplete:{type:"list",filter:"contains"},value:a.timezone||void 0,textValue:a.timezone?a.timezone.replace(/&/," "):void 0,onChange:r=>{s("timezone",r)},onTextValueChange:r=>{s("timezone",r)},onClear:()=>{s("timezone","")},children:t.map(r=>e.jsx(oe,{value:r.value,children:r.value.replace(/&/," ")},r.value))}),e.jsx(g.Error,{})]})},Be=E(H)`
  display: block;
`,Fe=E($e)`
  display: inline-block;
  &::first-letter {
    text-transform: uppercase;
  }
`,qe=o=>{let a;switch(o){case"ready":a="success";break;case"blocked":a="warning";break;case"failed":a="danger";break;case"done":a="primary";break;case"empty":default:a="neutral"}return{textColor:`${a}600`,backgroundColor:`${a}100`,borderColor:`${a}200`}},N=({sectionTitle:o,releases:a=[],isError:m=!1})=>{const{formatMessage:s}=M();return m?e.jsx(q.Error,{}):a?.length===0?e.jsx(Te,{content:s({id:"content-releases.page.Releases.tab.emptyEntries",defaultMessage:"No releases"},{target:o}),icon:e.jsx(ye,{width:"16rem"})}):e.jsx(U.Root,{gap:4,children:a.map(({id:n,name:t,scheduledAt:u,status:r})=>e.jsx(U.Item,{col:3,s:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(Be,{tag:Se,to:`${n}`,isExternal:!1,children:e.jsxs(S,{direction:"column",justifyContent:"space-between",padding:4,hasRadius:!0,background:"neutral0",shadow:"tableShadow",height:"100%",width:"100%",alignItems:"start",gap:4,children:[e.jsxs(S,{direction:"column",alignItems:"start",gap:1,children:[e.jsx(w,{textColor:"neutral800",tag:"h3",variant:"delta",fontWeight:"bold",children:t}),e.jsx(w,{variant:"pi",textColor:"neutral600",children:u?e.jsx(Fe,{timestamp:new Date(u)}):s({id:"content-releases.pages.Releases.not-scheduled",defaultMessage:"Not scheduled"})})]}),e.jsx(ve,{...qe(r),children:r})]})})},n))})},He=E(Me)`
  button {
    display: none;
  }
  p + div {
    margin-left: auto;
  }
`,We={name:"",date:Ie(new Date,"yyyy-MM-dd"),time:"",isScheduled:!0,scheduledAt:null,timezone:null},Ze=()=>{const o=B(),[a,m]=z.useState(!1),{toggleNotification:s}=le(),{formatMessage:n}=M(),t=de(),{formatAPIError:u}=ce(),[{query:r},h]=ue(),d=me(r),{data:p,isLoading:j}=ge(),[i,{isLoading:c}]=he(),{getFeature:b}=fe(),{maximumReleases:l=3}=b("cms-content-releases"),{trackUsage:f}=pe(),{allowedActions:{canCreate:v}}=xe(je),{isLoading:k,isSuccess:W,isError:A}=d,Y=d?.currentData?.meta?.activeTab||"pending";z.useEffect(()=>{o?.state?.errors&&(s({type:"danger",title:n({id:"content-releases.pages.Releases.notification.error.title",defaultMessage:"Your request could not be processed."}),message:n({id:"content-releases.pages.Releases.notification.error.message",defaultMessage:"Please try again or open another release."})}),t("",{replace:!0,state:null}))},[n,o?.state?.errors,t,s]);const I=()=>{m(C=>!C)};if(k||j)return e.jsx(q.Loading,{});const P=W&&d.currentData?.meta?.pendingReleasesCount||0,O=P>=l,G=C=>{h({...r,page:1,pageSize:d?.currentData?.meta?.pagination?.pageSize||16,filters:{releasedAt:{$notNull:C!=="pending"}}})},Q=async({name:C,scheduledAt:_,timezone:Z})=>{const T=await i({name:C,scheduledAt:_,timezone:Z});"data"in T?(s({type:"success",message:n({id:"content-releases.modal.release-created-notification-success",defaultMessage:"Release created."})}),f("didCreateRelease"),t(T.data.data.id.toString())):Le(T.error)?s({type:"danger",message:u(T.error)}):s({type:"danger",message:n({id:"notification.error",defaultMessage:"An error occurred"})})};return e.jsxs(be,{"aria-busy":k||j,children:[e.jsx($.Header,{title:n({id:"content-releases.pages.Releases.title",defaultMessage:"Releases"}),secondaryAction:e.jsx(Ce,{label:n({id:"components.premiumFeature.title",defaultMessage:"Premium feature"})}),subtitle:n({id:"content-releases.pages.Releases.header-subtitle",defaultMessage:"Create and manage content updates"}),primaryAction:v?e.jsx(D,{startIcon:e.jsx(Re,{}),onClick:I,disabled:O,children:n({id:"content-releases.header.actions.add-release",defaultMessage:"New release"})}):null}),e.jsx($.Content,{children:e.jsxs(e.Fragment,{children:[O&&e.jsx(He,{marginBottom:6,action:e.jsx(H,{href:"https://strapi.io/pricing-cloud",isExternal:!0,children:n({id:"content-releases.pages.Releases.max-limit-reached.action",defaultMessage:"Explore plans"})}),title:n({id:"content-releases.pages.Releases.max-limit-reached.title",defaultMessage:"You have reached the {number} pending {number, plural, one {release} other {releases}} limit."},{number:l}),onClose:()=>{},closeLabel:"",children:n({id:"content-releases.pages.Releases.max-limit-reached.message",defaultMessage:"Upgrade to manage an unlimited number of releases."})}),e.jsxs(R.Root,{variant:"simple",onValueChange:G,value:Y,children:[e.jsxs(y,{paddingBottom:8,children:[e.jsxs(R.List,{"aria-label":n({id:"content-releases.pages.Releases.tab-group.label",defaultMessage:"Releases list"}),children:[e.jsx(R.Trigger,{value:"pending",children:n({id:"content-releases.pages.Releases.tab.pending",defaultMessage:"Pending ({count})"},{count:P})}),e.jsx(R.Trigger,{value:"done",children:n({id:"content-releases.pages.Releases.tab.done",defaultMessage:"Done"})})]}),e.jsx(ze,{})]}),e.jsx(R.Content,{value:"pending",children:e.jsx(N,{sectionTitle:"pending",releases:d?.currentData?.data,isError:A})}),e.jsx(R.Content,{value:"done",children:e.jsx(N,{sectionTitle:"done",releases:d?.currentData?.data,isError:A})})]}),e.jsxs(L.Root,{...d?.currentData?.meta?.pagination,defaultPageSize:d?.currentData?.meta?.pagination?.pageSize,children:[e.jsx(L.PageSize,{options:["8","16","32","64"]}),e.jsx(L.Links,{})]})]})}),e.jsx(Ue,{open:a,handleClose:I,handleSubmit:Q,isLoading:c,initialValues:{...We,timezone:p?.data.defaultTimezone?p.data.defaultTimezone.split("&")[1]:null}})]})};export{$e as R,Ue as a,Ze as b,qe as g,Pe as u};
