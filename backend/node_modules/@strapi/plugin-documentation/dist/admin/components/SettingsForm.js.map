{"version":3,"file":"SettingsForm.js","sources":["../../../admin/src/components/SettingsForm.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport {\n  Box,\n  Button,\n  Flex,\n  Grid,\n  TextInput,\n  Toggle,\n  Typography,\n  Field,\n} from '@strapi/design-system';\n// Strapi Icons\nimport { Check, Eye as Show, EyeStriked as Hide } from '@strapi/icons';\nimport { translatedErrors, useRBAC, Layouts } from '@strapi/strapi/admin';\nimport { Form, Formik, FormikHelpers } from 'formik';\nimport { useIntl } from 'react-intl';\nimport { styled } from 'styled-components';\nimport * as yup from 'yup';\n\nimport { PERMISSIONS } from '../constants';\nimport { DocumentInfos, SettingsInput } from '../types';\nimport { getTrad } from '../utils';\n\nconst schema = yup.object().shape({\n  restrictedAccess: yup.boolean(),\n  password: yup.string().when('restrictedAccess', (value, initSchema) => {\n    return value\n      ? initSchema\n          .required(translatedErrors.required.id)\n          .min(8)\n          .matches(/[a-z]/, 'components.Input.error.contain.lowercase')\n          .matches(/[A-Z]/, 'components.Input.error.contain.uppercase')\n          .matches(/\\d/, 'components.Input.error.contain.number')\n      : initSchema;\n  }),\n});\n\nconst FieldActionWrapper = styled(Field.Action)`\n  svg {\n    height: 1.6rem;\n    width: 1.6rem;\n    path {\n      fill: ${({ theme }) => theme.colors.neutral600};\n    }\n  }\n`;\n\ntype SettingsFormProps = {\n  data?: DocumentInfos;\n  onSubmit: (body: SettingsInput, formik: FormikHelpers<SettingsInput>) => Promise<void>;\n};\n\nexport const SettingsForm = ({ data, onSubmit }: SettingsFormProps) => {\n  const { formatMessage } = useIntl();\n  const [passwordShown, setPasswordShown] = React.useState(false);\n  const { allowedActions } = useRBAC(PERMISSIONS);\n\n  return (\n    <Formik\n      enableReinitialize\n      initialValues={{\n        restrictedAccess: data?.documentationAccess.restrictedAccess || false,\n        password: '',\n      }}\n      onSubmit={onSubmit}\n      validationSchema={schema}\n    >\n      {({\n        handleSubmit,\n        values,\n        handleChange,\n        errors,\n        setFieldTouched,\n        setFieldValue,\n        setFieldError,\n        dirty,\n      }) => {\n        return (\n          <Form noValidate onSubmit={handleSubmit}>\n            <Layouts.Header\n              title={formatMessage({\n                id: getTrad('plugin.name'),\n                defaultMessage: 'Documentation',\n              })}\n              subtitle={formatMessage({\n                id: getTrad('pages.SettingsPage.header.description'),\n                defaultMessage: 'Configure the documentation plugin',\n              })}\n              primaryAction={\n                <Button\n                  type=\"submit\"\n                  startIcon={<Check />}\n                  disabled={!dirty && allowedActions.canUpdate}\n                >\n                  {formatMessage({\n                    id: getTrad('pages.SettingsPage.Button.save'),\n                    defaultMessage: 'Save',\n                  })}\n                </Button>\n              }\n            />\n            <Layouts.Content>\n              <Box\n                background=\"neutral0\"\n                hasRadius\n                shadow=\"filterShadow\"\n                paddingTop={6}\n                paddingBottom={6}\n                paddingLeft={7}\n                paddingRight={7}\n              >\n                <Flex direction=\"column\" alignItems=\"stretch\" gap={4}>\n                  <Typography variant=\"delta\" tag=\"h2\">\n                    {formatMessage({\n                      id: 'global.settings',\n                      defaultMessage: 'Settings',\n                    })}\n                  </Typography>\n                  <Grid.Root gap={4}>\n                    <Grid.Item col={6} s={12} direction=\"column\" alignItems=\"stretch\">\n                      <Field.Root\n                        name=\"restrictedAccess\"\n                        hint={formatMessage({\n                          id: getTrad('pages.SettingsPage.toggle.hint'),\n                          defaultMessage: 'Make the documentation endpoint private',\n                        })}\n                      >\n                        <Field.Label>\n                          {formatMessage({\n                            id: getTrad('pages.SettingsPage.toggle.label'),\n                            defaultMessage: 'Restricted Access',\n                          })}\n                        </Field.Label>\n                        <Toggle\n                          checked={values.restrictedAccess}\n                          onChange={() => {\n                            if (values.restrictedAccess === true) {\n                              setFieldValue('password', '', false);\n                              setFieldTouched('password', false, false);\n                              setFieldError('password', undefined);\n                            }\n\n                            setFieldValue('restrictedAccess', !values.restrictedAccess, false);\n                          }}\n                          onLabel=\"On\"\n                          offLabel=\"Off\"\n                        />\n                        <Field.Hint />\n                      </Field.Root>\n                    </Grid.Item>\n                    {values.restrictedAccess && (\n                      <Grid.Item col={6} s={12} direction=\"column\" alignItems=\"stretch\">\n                        <Field.Root\n                          name=\"password\"\n                          error={\n                            errors.password\n                              ? formatMessage({\n                                  id: errors.password,\n                                  defaultMessage: errors.password,\n                                })\n                              : undefined\n                          }\n                        >\n                          <Field.Label>\n                            {formatMessage({\n                              id: 'global.password',\n                              defaultMessage: 'Password',\n                            })}\n                          </Field.Label>\n                          <TextInput\n                            placeholder=\"**********\"\n                            type={passwordShown ? 'text' : 'password'}\n                            value={values.password}\n                            onChange={handleChange}\n                            endAction={\n                              <FieldActionWrapper\n                                onClick={(e) => {\n                                  e.stopPropagation();\n                                  setPasswordShown((prev) => !prev);\n                                }}\n                                label={formatMessage(\n                                  passwordShown\n                                    ? {\n                                        id: 'Auth.form.password.show-password',\n                                        defaultMessage: 'Show password',\n                                      }\n                                    : {\n                                        id: 'Auth.form.password.hide-password',\n                                        defaultMessage: 'Hide password',\n                                      }\n                                )}\n                              >\n                                {passwordShown ? <Show /> : <Hide />}\n                              </FieldActionWrapper>\n                            }\n                          />\n                          <Field.Error />\n                        </Field.Root>\n                      </Grid.Item>\n                    )}\n                  </Grid.Root>\n                </Flex>\n              </Box>\n            </Layouts.Content>\n          </Form>\n        );\n      }}\n    </Formik>\n  );\n};\n"],"names":["schema","yup","object","shape","restrictedAccess","boolean","password","string","when","value","initSchema","required","translatedErrors","id","min","matches","FieldActionWrapper","styled","Field","Action","theme","colors","neutral600","SettingsForm","data","onSubmit","formatMessage","useIntl","passwordShown","setPasswordShown","React","useState","allowedActions","useRBAC","PERMISSIONS","_jsx","Formik","enableReinitialize","initialValues","documentationAccess","validationSchema","handleSubmit","values","handleChange","errors","setFieldTouched","setFieldValue","setFieldError","dirty","_jsxs","Form","noValidate","Layouts","Header","title","getTrad","defaultMessage","subtitle","primaryAction","Button","type","startIcon","Check","disabled","canUpdate","Content","Box","background","hasRadius","shadow","paddingTop","paddingBottom","paddingLeft","paddingRight","Flex","direction","alignItems","gap","Typography","variant","tag","Grid","Root","Item","col","s","name","hint","Label","Toggle","checked","onChange","undefined","onLabel","offLabel","Hint","error","TextInput","placeholder","endAction","onClick","e","stopPropagation","prev","label","Show","Hide","Error"],"mappings":"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"}